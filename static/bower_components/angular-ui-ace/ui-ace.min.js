"use strict";angular.module("ui.ace",[]).constant("uiAceConfig",{}).directive("uiAce",["uiAceConfig",function(uiAceConfig){if(angular.isUndefined(window.ace)){throw new Error("ui-ace need ace to work... (o rly?)")}var setOptions=function(acee,session,opts){if(angular.isDefined(opts.showGutter)){acee.renderer.setShowGutter(opts.showGutter)}if(angular.isDefined(opts.useWrapMode)){session.setUseWrapMode(opts.useWrapMode)}if(angular.isDefined(opts.showInvisibles)){acee.renderer.setShowInvisibles(opts.showInvisibles)}if(angular.isDefined(opts.showIndentGuides)){acee.renderer.setDisplayIndentGuides(opts.showIndentGuides)}if(angular.isDefined(opts.useSoftTabs)){session.setUseSoftTabs(opts.useSoftTabs)}if(angular.isDefined(opts.disableSearch)&&opts.disableSearch){acee.commands.addCommands([{name:"unfind",bindKey:{win:"Ctrl-F",mac:"Command-F"},exec:function(){return false},readOnly:true}])}if(angular.isFunction(opts.onLoad)){opts.onLoad(acee)}if(angular.isString(opts.theme)){acee.setTheme("ace/theme/"+opts.theme)}if(angular.isString(opts.mode)){session.setMode("ace/mode/"+opts.mode)}};return{restrict:"EA",require:"?ngModel",link:function(scope,elm,attrs,ngModel){var options=uiAceConfig.ace||{};var opts=angular.extend({},options,scope.$eval(attrs.uiAce));var acee=window.ace.edit(elm[0]);var session=acee.getSession();var onChangeListener;var onBlurListener;var executeUserCallback=function(){var callback=arguments[0];var args=Array.prototype.slice.call(arguments,1);if(angular.isDefined(callback)){scope.$apply(function(){if(angular.isFunction(callback)){callback(args)}else{throw new Error("ui-ace use a function as callback.")}})}};var listenerFactory={onChange:function(callback){return function(e){var newValue=session.getValue();if(newValue!==scope.$eval(attrs.value)&&!scope.$$phase&&!scope.$root.$$phase){if(angular.isDefined(ngModel)){scope.$apply(function(){ngModel.$setViewValue(newValue)})}executeUserCallback(callback,e,acee)}}},onBlur:function(callback){return function(){executeUserCallback(callback,acee)}}};attrs.$observe("readonly",function(value){acee.setReadOnly(value==="true")});if(angular.isDefined(ngModel)){ngModel.$formatters.push(function(value){if(angular.isUndefined(value)||value===null){return""}else if(angular.isObject(value)||angular.isArray(value)){throw new Error("ui-ace cannot use an object or an array as a model")}return value});ngModel.$render=function(){session.setValue(ngModel.$viewValue)}}setOptions(acee,session,opts);scope.$watch(attrs.uiAce,function(){opts=angular.extend({},options,scope.$eval(attrs.uiAce));session.removeListener("change",onChangeListener);onChangeListener=listenerFactory.onChange(opts.onChange);session.on("change",onChangeListener);acee.removeListener("blur",onBlurListener);onBlurListener=listenerFactory.onBlur(opts.onBlur);acee.on("blur",onBlurListener);setOptions(acee,session,opts)},true);onChangeListener=listenerFactory.onChange(opts.onChange);session.on("change",onChangeListener);onBlurListener=listenerFactory.onBlur(opts.onBlur);acee.on("blur",onBlurListener);elm.on("$destroy",function(){acee.session.$stopWorker();acee.destroy()});scope.$watch(function(){return[elm[0].offsetWidth,elm[0].offsetHeight]},function(){if(angular.isDefined(opts.autoHeight)&&opts.autoHeight==true){var newHeight=acee.getSession().getScreenLength()*acee.renderer.lineHeight+acee.renderer.scrollBar.getWidth();angular.element(elm[0]).height(newHeight.toString()+"px")}acee.resize();acee.renderer.updateFull()},true)}}}]);